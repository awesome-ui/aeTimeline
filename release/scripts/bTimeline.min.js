function bTimelineService(){this.sliceIntervals=function(e,n,i){var t={beginDate:n,endDate:i};return angular.forEach(e,function(e){if(e.beginDate<t.endDate&&e.endDate>t.beginDate){var n=e.beginDate<t.beginDate?t.beginDate:e.beginDate,i=e.endDate>t.endDate?t.endDate:e.endDate,a=e.beginDate>=t.beginDate,l=e.endDate<=t.endDate;t.intervals=t.intervals||[],t.intervals.push({beginDate:n,isBegin:a,endDate:i,isEnd:l,interval:e})}}),t},this.updateDate=function(e,n){n=n||new Date,e.setHours(n.getHours()),e.setMinutes(n.getMinutes()),e.setSeconds(n.getSeconds())}}function bTimelineDirective(e){function n(){this.popup=null}function i(n,i,t,a){n.calcChunkIntervalLeft=function(e,n){{var i=(e.endDate.getTime()-e.beginDate.getTime())/100,t=(n.beginDate.getTime()-e.beginDate.getTime())/i;(e.endDate.getTime()-n.endDate.getTime())/i}return t+"%"},n.calcChunkIntervalRight=function(e,n){var i=(e.endDate.getTime()-e.beginDate.getTime())/100,t=(e.endDate.getTime()-n.endDate.getTime())/i;return t+"%"},n.$watchCollection("intervals",function(){if(n.intervals&&n.intervals.length){var i=e.sliceIntervals(n.intervals,n.beginDate,n.endDate);n.chunk=i}}),n.popup=null,n.popupInterval=null,n.popupShown=function(e){return n.popup===e},n.popupShow=function(e){n.popup=e,n.$emit("bTimelinePopupShow",n.popup)},n.popupShownInterval=function(e){return a.$viewValue&&a.$viewValue.interval&&a.$viewValue.interval.interval===e.interval},n.popupShowInterval=function(e){n.popupInterval=e,n.popupShow(n.bTimeline.popup),a.$viewValue&&(a.$viewValue.interval=e)}}return n.$inject=["$scope"],{restrict:"E",require:"ngModel",template:'<div class="b-timeline"><div class="b-timeline__interval" b-timeline-interval ng-repeat="interval in chunk.intervals track by $index" ng-click="popupShowInterval(interval)" ng-class="{_isBegin:interval.isBegin,_isEnd:interval.isEnd,_isSelected:popupShownInterval(interval),_isStarted:false}" ng-style="{left:calcChunkIntervalLeft(chunk,interval), right:calcChunkIntervalRight(chunk,interval)}"></div><div class="b-timeline__popup" b-timeline-popup ng-click="popupInterval=null; popupShow(bTimelinePopup)" ng-class="{_isShown:popupShown(bTimelinePopup)}"><div class="b-timeline-popup" ng-if="popupShown(bTimelinePopup)"><div class="b-timeline-popup__main" ng-class="{_hasInterval:popupInterval}"><div class="b-timeline-popup-interval" b-timeline-popup-interval>{{popupInterval.interval}}</div></div></div></div></div>',scope:{beginDate:"=timelineBeginDate",endDate:"=timelineEndDate",intervals:"=timelineIntervals"},controllerAs:"bTimeline",controller:n,link:i}}function bTimelineIntervalDirective(){function e(){}return{restrict:"A",require:"^bTimeline",link:e}}function bTimelinePopupDirective(){function e(e){e.incrBeginHours=function(e){e.beginDate.setHours(e.beginDate.getHours()+1),e.beginDate>e.endDate&&e.beginDate.setTime(e.endDate.getTime())},e.incrBeginMinutes=function(e){e.beginDate.setMinutes(e.beginDate.getMinutes()+15),e.beginDate>e.endDate&&e.beginDate.setTime(e.endDate.getTime())},e.decrBeginHours=function(e){e.beginDate.setHours(e.beginDate.getHours()-1)},e.decrBeginMinutes=function(e){e.beginDate.setMinutes(e.beginDate.getMinutes()-15)},e.incrEndHours=function(e){e.endDate.setHours(e.endDate.getHours()+1)},e.incrEndMinutes=function(e){e.endDate.setMinutes(e.endDate.getMinutes()+15)},e.decrEndHours=function(e){e.endDate.setHours(e.endDate.getHours()-1),e.endDate<e.beginDate&&e.endDate.setTime(e.beginDate.getTime())},e.decrEndMinutes=function(e){e.endDate.setMinutes(e.endDate.getMinutes()-15),e.endDate<e.beginDate&&e.endDate.setTime(e.beginDate.getTime())}}function n(e){e.$on("bTimelinePopupShown",function(n,i){e.bTimelinePopup!==i&&(e.popup=null)}),e.bTimeline.popup=e.bTimelinePopup}return e.$inject=["$scope"],{restrict:"A",require:"^bTimeline",controllerAs:"bTimelinePopup",controller:e,link:n}}function bTimelinePopupIntervalDirective(){function e(e){e.$on("$destroy",function(){console.warn("destroy popup interval",e.popupInterval),e.popupInterval})}return{restrict:"A",require:"^bTimelinePopup",link:e}}angular.module("bTimeline",[]).service("bTimeline",bTimelineService).directive("bTimeline",bTimelineDirective).directive("bTimelineInterval",bTimelineIntervalDirective).directive("bTimelinePopup",bTimelinePopupDirective).directive("bTimelinePopupInterval",bTimelinePopupIntervalDirective),bTimelineDirective.$inject=["bTimeline"],bTimelineIntervalDirective.$inject=["bTimeline"],bTimelinePopupDirective.$inject=["bTimeline"],bTimelinePopupIntervalDirective.$inject=["bTimeline"];